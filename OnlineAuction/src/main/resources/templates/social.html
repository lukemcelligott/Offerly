<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Social Page</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom Styles -->
    <link th:href="@{/styles/button.css}" rel="stylesheet" />
    <link th:href="@{/styles/landing.css}" rel="stylesheet" />
    <link th:href="@{/styles/employee_page.css}" rel="stylesheet" />
    <link th:href="@{/styles/social.css}" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    
    <!-- jQuery and jQuery UI CSS -->
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	
	<!-- jQuery and jQuery UI JS -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

    <style>
    </style>
    
</head>

<body>

	<!-- HEADER BAR -->
    <div th:insert="header :: header" th:unless="${user == null}"></div>

    <!-- Main Content Wrapper -->
    <div class="container mt-5">

        <!-- Alert for friend request sent -->
        <div th:if="${requestSent}" class="alert alert-success" role="alert">
            Friend request has been sent!
        </div>

        <!-- Alert for error message -->
        <div th:if="${errorMessage}" class="alert alert-danger" role="alert" th:text="${errorMessage}"></div>

        <!-- Start of Row -->
        <div class="row mb-5">

			<!-- Left Container: Friends List Section -->
			<div class="col-md-6">
			    <div class="container p-4 bg-white rounded shadow">
			        <h3>Friends List</h3>
			        
			        <!-- Search Input for Friends -->
			        <input type="text" id="friendSearch" placeholder="Search for a friend..." class="form-control mb-3" />
			        
			        <ul class="list-group" id="friendList">
			            <li class="list-group-item friend-item" th:each="friend : ${friends}">
			                <span th:text="${friend.username}"></span>
			
			                <div class="float-end">
							    <!-- View Profile Button -->
							    <a th:href="@{'/viewProfile/' + ${friend.id}}" class="btn btn-sm btn-success custom-btn-space">
							        <i class="fas fa-user"></i>
							    </a>
							
							    <!-- Message Button -->
							    <a th:href="@{/inbox}" class="btn btn-sm btn-primary custom-btn-space">
							        <i class="fas fa-comment-alt"></i>
							    </a>
							
							    <!-- Remove Button -->
							    <form th:action="@{/remove}" method="post" style="display: inline;">
							        <input type="hidden" th:value="${friend.id}" name="friendId" />
							        <button class="btn btn-sm btn-danger custom-btn-space" type="submit">
							            <i class="fas fa-trash"></i>
							        </button>
							    </form>
							</div>
			            </li>
			        </ul>
			    </div>
			</div>

            <!-- Right Container: Add Friend & Friend Requests Section -->
            <div class="col-md-6">
                <div class="container p-4 bg-white rounded shadow">
                    <!-- Add Friend Section -->
					<h3>
					    Add Friend					    
					</h3>
					
					<form th:action="@{/add}" method="post">
					    <!-- Input field for searching friends by username -->
					    <div class="searchWrapper">
					        <!-- No more datalist reference here -->
					        <input id="addValue" name="value" placeholder="Search by username..." class="form-control mb-3" autocomplete="off" />
					    </div>
					    
					    <button type="submit" class="btn btn-primary w-100 mb-4">Add Friend</button>
					</form>

                    <!-- Friend Requests Section -->
                    <h3>Friend Requests</h3>
                    <ul class="list-group">
                        <li class="list-group-item" th:each="request : ${friendRequests}">
                            <span th:text="${request.sender.username}"></span>

                            <div class="float-end">
                                <!-- Accept Button -->
                                <form th:action="@{/acceptRequest}" method="post" style="display: inline;">
                                    <input type="hidden" th:value="${request.id}" name="requestId" />
                                    <button class="btn btn-sm btn-success me-2" type="submit">Accept</button>
                                </form>

                                <!-- Decline Button -->
                                <form th:action="@{/declineRequest}" method="post" style="display: inline;">
                                    <input type="hidden" th:value="${request.id}" name="requestId" />
                                    <button class="btn btn-sm btn-danger" type="submit">Decline</button>
                                </form>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

	<script>
		$(document).ready(function() {
		    $("#addValue").autocomplete({
		        source: function(request, response) {
		            $.ajax({
		                url: "/searchUser",
		                dataType: "json",
		                data: {
		                    userName: request.term,
		                },
		                success: function(data) {
		                    response(data.map(user => user.username));
		                }
		            });
		        },
		        minLength: 2, // Trigger search after 2 characters
		        select: function(event, ui) {
		            // Optionally do something when an option is selected
		        }
		    });
		});
		
	</script>
	<script>
		$(document).ready(function(){
	        $("#friendSearch").on("keyup", function() {
	            var value = $(this).val().toLowerCase();
	            $("#friendList .friend-item").filter(function() {
	                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
	            });
	        });
    	});
	</script>

</body>

</html>