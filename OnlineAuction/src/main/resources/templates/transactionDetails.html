<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="ISO-8859-1">
		<title>Purchase Details</title>
		
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
	  	
	  	<!-- font import -->
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
		
		<link th:href="@{/styles/employee_page.css}" rel="stylesheet"/>
	  	
	  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	  	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
	  	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
	  	
		
		<style>
			#page {
				display: flex;
				height: 120vh;
			}
			
			#website-title {
				margin-left: 8px;
				margin-right: 8px;
				font-size: 12px;
			}
		</style>
	</head>
	
	<body>
	
		<!-- HEADER BAR -->
		<div th:insert="header :: header"></div>
		<!-- END HEADER BAR -->
	
	
		<!-- Paypal Delete popup -->
		<div class="modal fade" id="deleteTransactionModal" tabindex="-1">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="deleteTransactionModal">Delete Payment Details</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<p>This will delete this transaction - are you sure?
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
						<form method="post" action="#"
							th:action="@{/viewTransactionDetails/deleteTransaction}">
							<button type="submit" class="btn btn-danger" name="delete">Delete</button>
						</form>
					</div>
				</div>
			</div>
		</div>
		<div id="page">
			<div class="card h-100 w-100">
				<div class="card-header d-flex justify-content-center">
					<h1>Transaction Details</h1>
				</div>
				<div class="card-body">
					<div th:if="${errMessage != null}" th:text="${errMessage}" class="alert alert-danger d-flex justify-content-center my-1 h3">
					</div>
					<div th:if="${!trans.shippingEntry.hasShipped() && user.id != trans.seller.id}" class="alert alert-info d-flex justify-content-center h3">
						This purchase has not shipped yet - check back for updates!
					</div>
					<div th:if="${trans.shippingEntry.hasArrived() && user.id != trans.seller.id}" class="alert alert-success d-flex justify-content-center h3">
						This purchase has arrived!
					</div>
					<div class="my-2">
						<div class="d-flex justify-content-center">
							<h2>Purchase Information</h2>
						</div>
						<div class="container">
							<div class="row">
								<ul class="list-group col-sm-4">
									<li class="list-group-item">
										Widget Name: <span th:text="${trans.marketListing.widgetSold.name}"></span>
									</li>
									<li class="list-group-item">
										Widget Description: <span th:text="${trans.marketListing.widgetSold.description}"></span>
									</li>
								</ul>
								<ul class="list-group col-sm-4">
									<li class="list-group-item">Number Purchased: <span th:text="${trans.qtyBought}"></span></li>
									<li class="list-group-item">Purchase Date: <span th:text="${trans.purchaseDate}"></span></li>
								</ul>
								<ul class="list-group col-sm-4">
									<li class="list-group-item">Price Before Taxes: $<span th:text="${trans.totalPriceBeforeTaxes}"></span></li>
									<li class="list-group-item">Price After Taxes: $<span th:text="${trans.totalPriceAfterTaxes}"></span></li>
									<li class="list-group-item" th:if="${user.id == trans.seller.id}">Your Profit: $<span th:text="${trans.sellerProfit}"></span></li>
								</ul>
							</div>
						</div>
					</div>
					<div class="my-2">
						<div class="d-flex justify-content-center">
							<h2>Shipping Information</h2>
						</div>
						<div class="container">
							<div class="row">
								<ul class="list-group col-sm-3">
									<li class="list-group-item">Recipient: <span th:text="${trans.shippingEntry.address.recipient}"></span></li>
									<li class="list-group-item">Street Address: <span th:text="${trans.shippingEntry.address.streetAddress}"></span></li>
								</ul>
								<ul class="list-group col-sm-3">
									<li class="list-group-item">Postal Code: <span th:text="${trans.shippingEntry.address.postalCode}"></span></li>
									<li class="list-group-item">State: <span th:text="${trans.shippingEntry.address.state.stateName}"></span></li>
								</ul>
								<ul class="list-group col-sm-3">
									<li class="list-group-item">Carrier: <span th:text="${trans.shippingEntry.carrier}"></span></li>
									<li class="list-group-item">Shipping Date: <span th:text="${trans.shippingEntry.shippingDate}"></span></li>
								</ul>
								<ul class="list-group col-sm-3">
									<li class="list-group-item">Arrival Date: <span th:text="${trans.shippingEntry.arrivalDate}"></span></li>
								</ul>
							</div>
						</div>
					</div>
					<!-- If seller, give access to changing shipping information -->
					<form th:if="${user.id == trans.seller.id}"
						  method="post" action="#"
						  th:action="@{/viewTransactionDetails/submitShippingUpdate}" th:object="${shipping}">
  						<div class="d-flex justify-content-center">
							<h2>Update Shipping Information</h2>
						</div>
						<div class="container">
							<div class="row">
							  	<div class="mb-3 col-sm-4">
					  			  <label for="carrier" class="form-label">Carrier</label>
								  <input type="text" class="form-control" name="carrier" th:field="*{carrier}">
								  <p th:if="${carrierErr != null}" th:text="${carrierErr}"></p>
								</div>
								<div class="mb-3 col-sm-4">
								  <label for="shippingDate" class="form-label">Shipping Date</label>
								  <input type="date" name="shippingDate" class="form-control" th:field="*{shippingDate}">
								  <p th:if="${shippingDateErr != null}" th:text="${shippingDateErr}"></p>
								</div>
								<div class="mb-3 col-sm-4">
								  <label for="arrivalDate" class="form-label">Arrival Date</label>
								  <input type="date" class="form-control" name="arrivalDate" th:field="*{arrivalDate}">
								  <p th:if="${arrivalDateErr != null}" th:text="${arrivalDateErr}"></p>
								</div>
							</div>
						</div>
						<div class="d-flex justify-content-evenly">
								<button disabled th:if="${!canDelete}" type="submit" class="btn btn-danger" name="submit">Cancel Transaction</button>
								<a th:if="${canDelete}" class="btn btn-danger"
									data-bs-toggle="modal" data-bs-target="#deleteTransactionModal">
									Cancel Transaction
								</a>
						  		<button type="submit" class="btn btn-success" name="submit">Submit Changes</button>
						</div>
					</form>
					<div th:unless="${user.id == trans.seller.id}" class="d-flex justify-content-center">
						<button disabled th:if="${!canDelete}" type="submit" class="btn btn-danger" name="submit">Cancel Transaction</button>
						<a th:if="${canDelete}" class="btn btn-danger"
							data-bs-toggle="modal" data-bs-target="#deleteTransactionModal">
							Cancel Transaction
						</a>
						<button class="btn btn-outline-success" type="button" onclick="location.href='/homePage'" style="float:left; margin-left:16px;">Home</button>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>